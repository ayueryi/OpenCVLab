<UserControl
    x:Class="OpenCVLab.View.Dialog.LinearGrayTransformDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:controls="clr-namespace:OpenCVLab.View.Controls"
    xmlns:local="clr-namespace:OpenCVLab.View.Dialog"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://Yu-UI.com//2024/xaml"
    d:DataContext="{d:DesignInstance local:LinearGrayTransformDialog,
                                     IsDesignTimeCreatable=False}"
    mc:Ignorable="d">

    <Border Background="White"
            Style="{StaticResource BorderRegion}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <ui:Title MainTitle="灰度线性变换"
                    SubTitle="Linear Gray Transform"/>

            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>

                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel
                        Grid.Column="0"
                        Margin="0,0,16,0"
                        Orientation="Vertical">
                        <TextBlock Margin="0,0,0,6"
                                Opacity="0.8">
                            点击右侧直方图选择输入灰度范围（两条竖线），再设置输出范围。
                        </TextBlock>

                        <StackPanel Margin="0,6"
                                Orientation="Horizontal">
                            <TextBlock Width="140"
                                    VerticalAlignment="Center">预设（alfa,beta）</TextBlock>
                            <ComboBox Width="200"
                                    SelectedIndex="{Binding SelectedPresetIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <ComboBoxItem Content="自定义（范围拉伸）"/>
                                <ComboBoxItem Content="灰度上移 (1, 50)"/>
                                <ComboBoxItem Content="灰度下移 (1, -50)"/>
                                <ComboBoxItem Content="对比度增强 (1.5, 0)"/>
                                <ComboBoxItem Content="对比度减小 (0.75, 0)"/>
                                <ComboBoxItem Content="暗亮互换 (-0.5, 0)"/>
                                <ComboBoxItem Content="灰度反转 (-1, 255)"/>
                            </ComboBox>
                        </StackPanel>

                        <TextBlock
                            Margin="140,2,0,6"
                            Opacity="0.75"
                            Text="预设模式：Dst = alfa * D + beta"/>

                        <StackPanel
                            Margin="0,6"
                            IsEnabled="{Binding IsCustomMode}"
                            Orientation="Horizontal">
                            <TextBlock Width="140"
                                    VerticalAlignment="Center">输入最小灰度</TextBlock>
                            <ui:NumericBox
                                Width="200"
                                Maximum="255"
                                Minimum="0"
                                Value="{Binding InMin, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel
                            Margin="0,6"
                            IsEnabled="{Binding IsCustomMode}"
                            Orientation="Horizontal">
                            <TextBlock Width="140"
                                    VerticalAlignment="Center">输入最大灰度</TextBlock>
                            <ui:NumericBox
                                Width="200"
                                Maximum="255"
                                Minimum="0"
                                Value="{Binding InMax, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <Separator Margin="0,8"/>

                        <StackPanel
                            Margin="0,6"
                            IsEnabled="{Binding IsCustomMode}"
                            Orientation="Horizontal">
                            <TextBlock Width="140"
                                    VerticalAlignment="Center">输出最小灰度</TextBlock>
                            <ui:NumericBox
                                Width="200"
                                Maximum="255"
                                Minimum="0"
                                Value="{Binding OutMin, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>

                        <StackPanel
                            Margin="0,6"
                            IsEnabled="{Binding IsCustomMode}"
                            Orientation="Horizontal">
                            <TextBlock Width="140"
                                    VerticalAlignment="Center">输出最大灰度</TextBlock>
                            <ui:NumericBox
                                Width="200"
                                Maximum="255"
                                Minimum="0"
                                Value="{Binding OutMax, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                        </StackPanel>
                    </StackPanel>

                    <Border
                        Grid.Column="1"
                        Padding="8"
                        Style="{StaticResource BorderRegion}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock
                                Margin="0,0,0,6"
                                FontWeight="SemiBold"
                                Text="直方图"/>

                            <Grid
                                Grid.Row="1"
                                MouseLeftButtonDown="HistogramMouseLeftButtonDown"
                                MouseLeftButtonUp="HistogramMouseLeftButtonUp"
                                MouseMove="HistogramMouseMove">
                                <Image
                                    x:Name="HistogramImage"
                                    Width="300"
                                    Height="150"
                                    Panel.ZIndex="0"
                                    Source="{Binding HistogramImageSource}"
                                    Stretch="Fill"/>

                                <controls:HistogramRangeOverlayCanvas
                                    Width="300"
                                    Height="150"
                                    Panel.ZIndex="1"
                                    Background="Transparent"
                                    InMax="{Binding InMax}"
                                    InMin="{Binding InMin}"
                                    Stroke="{DynamicResource SystemAccentColorBrush}"
                                    StrokeThickness="2"/>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <Border Grid.Row="1">
                    <UniformGrid Columns="2">
                        <Button Click="Confirm">
                            <StackPanel Orientation="Horizontal">
                                <ui:Icon Margin="0,0,8,0"
                                        Kind="CheckCircleOutline"/>
                                <TextBlock VerticalAlignment="Center">确认</TextBlock>
                            </StackPanel>
                        </Button>

                        <Button Click="Cancel">
                            <StackPanel Orientation="Horizontal">
                                <ui:Icon Margin="0,0,8,0"
                                        Kind="CloseCircleOutline"/>
                                <TextBlock VerticalAlignment="Center">取消</TextBlock>
                            </StackPanel>
                        </Button>
                    </UniformGrid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</UserControl>
