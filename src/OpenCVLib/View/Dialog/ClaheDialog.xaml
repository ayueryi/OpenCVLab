<UserControl
    x:Class="OpenCVLab.View.Dialog.ClaheDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:OpenCVLab.View.Dialog"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://Yu-UI.com//2024/xaml"
    d:DataContext="{d:DesignInstance local:ClaheDialog,
                                     IsDesignTimeCreatable=False}"
    mc:Ignorable="d">

    <Border Background="White"
            Style="{StaticResource BorderRegion}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <ui:Title MainTitle="自适应直方图均衡化 (CLAHE)"
                    SubTitle="Contrast Limited Adaptive Histogram Equalization"/>

            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>

                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel
                        Grid.Column="0"
                        Margin="0,0,16,0"
                        Orientation="Vertical">
                        <TextBlock Margin="0,0,0,12"
                                Opacity="0.8"
                                TextWrapping="Wrap">
                            CLAHE 是一种局部直方图均衡化方法，相比全局直方图均衡化能更好地保留细节，避免过度增强。<LineBreak/>
                            它将图像分割成小块，对每一块进行限制对比度的直方图均衡化。
                        </TextBlock>

                        <StackPanel Margin="0,12"
                                Orientation="Horizontal">
                            <TextBlock Width="160"
                                    VerticalAlignment="Center">对比度限制 (Clip Limit)</TextBlock>
                            <Slider
                                Width="200"
                                VerticalAlignment="Center"
                                Maximum="100"
                                Minimum="1"
                                TickFrequency="1"
                                Value="{Binding ClipLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock
                                Margin="12,0,0,0"
                                VerticalAlignment="Center"
                                FontWeight="Medium"
                                Text="{Binding ClipLimit, StringFormat='{}{0:F1}'}"/>
                        </StackPanel>

                        <TextBlock
                            Margin="160,0,0,12"
                            Opacity="0.7"
                            Text="限制对比度增强的幅度，防止噪声被过度放大"
                            TextWrapping="Wrap"/>

                        <StackPanel Margin="0,12"
                                Orientation="Horizontal">
                            <TextBlock Width="160"
                                    VerticalAlignment="Center">分块大小 (Tile Grid Size)</TextBlock>
                            <Slider
                                Width="200"
                                VerticalAlignment="Center"
                                Maximum="32"
                                Minimum="2"
                                TickFrequency="2"
                                Value="{Binding TileGridSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock
                                Margin="12,0,0,0"
                                VerticalAlignment="Center"
                                FontWeight="Medium"
                                Text="{Binding TileGridSize}"/>
                        </StackPanel>

                        <TextBlock
                            Margin="160,0,0,12"
                            Opacity="0.7"
                            Text="将图像分割成 N×N 个块进行处理，越小处理越精细"
                            TextWrapping="Wrap"/>

                        <Border
                            Margin="0,12"
                            Padding="12"
                            Background="#F5F5F5"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="4">
                            <StackPanel>
                                <TextBlock FontWeight="SemiBold"
                                        Text="参数说明："/>
                                <TextBlock Margin="0,4,0,0"
                                        Opacity="0.8"
                                        TextWrapping="Wrap">
                                    • <Bold>Clip Limit</Bold>: 1-100，默认 40。越大对比度增强越明显<LineBreak/>
                                    • <Bold>Tile Grid Size</Bold>: 2-32，默认 8。越小局部化程度越高<LineBreak/>
                                    • 建议：一般图像使用默认值；细节丰富的图像可增大分块；噪声多的图像应降低限制值
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <Border
                        Grid.Column="1"
                        Padding="8"
                        Style="{StaticResource BorderRegion}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock
                                Margin="0,0,0,6"
                                FontWeight="SemiBold"
                                Text="直方图"/>

                            <Image
                                x:Name="HistogramImage"
                                Grid.Row="1"
                                Width="300"
                                Height="150"
                                Source="{Binding HistogramImageSource}"
                                Stretch="Fill"/>
                        </Grid>
                    </Border>
                </Grid>

                <Grid
                    Grid.Row="1"
                    Margin="20,0,20,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button
                        Grid.Column="1"
                        Width="100"
                        Margin="0,0,10,0"
                        Click="Confirm"
                        Content="确定"/>
                    <Button
                        Grid.Column="2"
                        Width="100"
                        Click="Cancel"
                        Content="取消"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</UserControl>
