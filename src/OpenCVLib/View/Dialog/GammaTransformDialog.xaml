<UserControl
    x:Class="OpenCVLab.View.Dialog.GammaTransformDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:OpenCVLab.View.Dialog"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://Yu-UI.com//2024/xaml"
    d:DataContext="{d:DesignInstance local:GammaTransformDialog,
                                     IsDesignTimeCreatable=False}"
    mc:Ignorable="d">

    <Border Background="White"
            Style="{StaticResource BorderRegion}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <ui:Title MainTitle="伽马变换"
                      SubTitle="Gamma Transform"/>

            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>

                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel
                        Grid.Column="0"
                        Margin="0,0,16,0"
                        Orientation="Vertical">
                        <TextBlock Margin="0,0,0,12"
                                   Opacity="0.8"
                                   TextWrapping="Wrap">
                            伽马变换用于调整图像亮度，适用于过亮或过暗的图像。<LineBreak/>
                            公式：Dst = 255 × (Src / 255)^γ
                        </TextBlock>

                        <StackPanel Margin="0,6"
                                    Orientation="Horizontal">
                            <TextBlock Width="140"
                                       VerticalAlignment="Center">预设伽马值</TextBlock>
                            <ComboBox Width="250"
                                      SelectedIndex="{Binding SelectedPresetIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <ComboBoxItem Content="自定义"/>
                                <ComboBoxItem Content="增强暗部 (γ = 0.4)"/>
                                <ComboBoxItem Content="提亮图像 (γ = 0.67)"/>
                                <ComboBoxItem Content="线性 (γ = 1.0)"/>
                                <ComboBoxItem Content="压暗图像 (γ = 1.5)"/>
                                <ComboBoxItem Content="增强亮部 (γ = 2.5)"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel
                            Margin="0,12"
                            IsEnabled="{Binding IsCustomMode}"
                            Orientation="Horizontal">
                            <TextBlock Width="140"
                                       VerticalAlignment="Center">伽马值 (γ)</TextBlock>
                            <Slider
                                Width="250"
                                VerticalAlignment="Center"
                                Maximum="3.0"
                                Minimum="0.1"
                                TickFrequency="0.1"
                                Value="{Binding Gamma, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock
                                Margin="12,0,0,0"
                                VerticalAlignment="Center"
                                FontWeight="Medium"
                                Text="{Binding Gamma, StringFormat='{}{0:F2}'}"/>
                        </StackPanel>

                        <Border
                            Margin="0,6"
                            Padding="12"
                            Background="#F5F5F5"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="4">
                            <StackPanel>
                                <TextBlock FontWeight="SemiBold"
                                           Text="说明："/>
                                <TextBlock Margin="0,4,0,0"
                                           Opacity="0.8"
                                           TextWrapping="Wrap">
                                    • γ &lt; 1: 提亮图像，增强暗部细节<LineBreak/>
                                    • γ = 1: 不改变图像<LineBreak/>
                                    • γ &gt; 1: 压暗图像，增强亮部细节
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <Border
                        Grid.Column="1"
                        Padding="8"
                        Style="{StaticResource BorderRegion}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock
                                Margin="0,0,0,6"
                                FontWeight="SemiBold"
                                Text="直方图"/>

                            <Image
                                x:Name="HistogramImage"
                                Grid.Row="1"
                                Width="300"
                                Height="150"
                                Source="{Binding HistogramImageSource}"
                                Stretch="Fill"/>
                        </Grid>
                    </Border>
                </Grid>

                <Grid
                    Grid.Row="1"
                    Margin="20,0,20,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button
                        Grid.Column="1"
                        Width="100"
                        Margin="0,0,10,0"
                        Click="Confirm"
                        Content="确定"/>
                    <Button
                        Grid.Column="2"
                        Width="100"
                        Click="Cancel"
                        Content="取消"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</UserControl>
